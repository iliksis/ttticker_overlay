# See https://fly.io/docs/app-guides/continuous-deployment-with-github-actions/

name: Deploy
on: workflow_dispatch

jobs:
  deploy:
      name: Deploy app
      runs-on: ubuntu-latest
      concurrency: deploy-group # optional: ensure only one action runs at a time
      steps:
        - name: Checkout
          uses: actions/checkout@v5.0.0
        - uses: jacobtomlinson/gha-find-replace@3.0.5
          with:
            include: "*/extension/*"
            find: "{{baseURL}}"
            replace: secrets.baseUrl
        - uses: montudor/action-zip@v1.0.0
          with:
            args: zip -qq -r ./static/extension.zip ./src/lib/extension
        - uses: superfly/flyctl-actions/setup-flyctl@master
        - run: flyctl deploy --remote-only
          env:
            FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
